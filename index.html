<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Banpang - 2024</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Option 1: Include in HTML -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css"
    />
    <style>
      /* Option 2: Import via CSS */
      @import url("https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css");
      * {
        box-sizing: border-box;
      }
      .img-zoom-container {
        position: relative;
      }

      .img-zoom-lens {
        position: absolute;
        border: 1px solid #d4d4d4;
        /*set the size of the lens:*/
        width: 40px;
        height: 40px;
      }

      .img-zoom-result {
        border: 1px solid #d4d4d4;
        /*set the size of the result div:*/
        width: 300px;
        height: 300px;
      }

      .dot {
        width: 15px;
        height: 15px;
        display: block;
        border-radius: 50%;
      }
    </style>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
  </head>
  <body>
    <div class="p-4">
      <div class="row">
        <div class="col-9">
          <h1 id="title">Data Penerima Bantuan Pangan</h1>
        </div>
        <div class="col-3">
          <p>Di Perbarui: 23 OKT 2024</p>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-12 col-md-4">
          <div class="form-group">
            <label for="select-alokasi">Alokasi</label>
            <select class="form-control" id="select-alokasi">
              <option>Pilih alokasi..</option>
              <option value="AGUSTUS">AGUSTUS - 2024</option>
              <option value="OKTOBER">OKTOBER - 2024</option>
            </select>
          </div>
        </div>
        <div class="col-sm-12 col-md-4">
          <div class="form-group">
            <label for="select-kecamatan">Kecamatan</label>
            <select class="form-control" id="select-kecamatan" disabled>
              <option>Pilih Kecamatan</option>
              <option value="AMPELGADING">AMPELGADING</option>
              <option value="BANTARBOLANG">BANTARBOLANG</option>
              <option value="BELIK">BELIK</option>
              <option value="BODEH">BODEH</option>
              <option value="COMAL">COMAL</option>
              <option value="MOGA">MOGA</option>
              <option value="PEMALANG">PEMALANG</option>
              <option value="PETARUKAN">PETARUKAN</option>
              <option value="PULOSARI">PULOSARI</option>
              <option value="RANDUDONGKAL">RANDUDONGKAL</option>
              <option value="TAMAN">TAMAN</option>
              <option value="ULUJAMI">ULUJAMI</option>
              <option value="WARUNGPRING">WARUNGPRING</option>
              <option value="WATUKUMPUL">WATUKUMPUL</option>
            </select>
          </div>
        </div>
        <div class="col-sm-12 col-md-4">
          <div class="form-group">
            <label for="select-desa">Desa</label>
            <select class="form-control" id="select-desa" disabled></select>
          </div>
        </div>
      </div>
      <div class="mt-2">
        <div class="d-flex justify-content-between">
          <div>
            <span class="badge rounded-pill bg-info" id="jumlah-pbp"
              >JUMLAH</span
            >
            <span class="badge rounded-pill bg-dark" id="jumlah-awal"
              >AWAL</span
            >
            <span class="badge rounded-pill bg-success" id="jumlah-pengganti"
              >PENGGANTI</span
            >
            <span class="badge rounded-pill bg-primary" id="jumlah-perwakilan"
              >PERWAKILAN</span
            >
            <span class="badge rounded-pill bg-danger" id="jumlah-sisa"
              >SISA</span
            >
          </div>
          <div>
            <input
              class="form-check-input"
              type="checkbox"
              value=""
              id="check-open-foto-all"
            />
            <label class="form-check-label" for="check-open-foto-all">
              Buka semua foto
            </label>
          </div>
        </div>
      </div>
      <table
        class="table table-hover mt-4 table-responsive d-none"
        id="table-main"
      >
        <thead>
          <tr>
            <th scope="col" style="width: 3%">#</th>
            <th scope="col" style="width: 10%">NO PBP</th>
            <th scope="col" style="width: 12%">NIK PBP Awal</th>
            <th scope="col" style="width: 12%">NIK Penerima</th>
            <th scope="col">Nama PBP Awal</th>
            <th scope="col">Nama Penerima(Pekerjaan)</th>
            <th scope="col" id="header-status" style="cursor: pointer">
              Alasan <i class="bi bi-sort-up"></i>
            </th>
          </tr>
        </thead>
        <tbody id="table-body"></tbody>
      </table>
    </div>
    <style>
      .toast {
        display: none; /* Hidden by default */
        position: fixed; /* Sit on top of the screen */
        top: 0;
        left: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        background-color: rgba(
          0,
          0,
          0,
          0.5
        ); /* Black background with 50% opacity */
        color: white; /* Text color */
        align-items: center; /* Center content vertically */
        justify-content: center; /* Center content horizontally */
        flex-direction: column; /* Stack items vertically */
        z-index: 1000; /* Stay on top */
        animation: fadeIn 0.5s, fadeOut 0.5s 4.5s; /* Fade in and out */
        display: flex; /* Use flexbox for centering */
      }

      .toast-image {
        max-width: 80%; /* Adjust image size */
        border-radius: 10px; /* Rounded corners */
        margin-bottom: 20px; /* Space between image and text */
      }
    </style>
    <div id="toast" class="toast">
      <img
        src="https://jplogistics.co.id/wp-content/uploads/2023/08/logo-jp-logistic-300x91.png"
        alt="Image"
        class="toast-image"
      />
    </div>

    <div id="toast-loading" class="toast">
      <lottie-player
        src="./lottie/loading.json"
        background="transparent"
        speed="1"
        style="width: 200px; height: 200px"
        loop
        autoplay
      ></lottie-player>
    </div>
    <script>
      const toast = document.getElementById("toast");
      toast.style.display = "flex"; // Show the toast
      setTimeout(() => {
        toast.style.display = "none"; // Hide the toast after 5 seconds
      }, 2000); // 5000 milliseconds = 5 seconds
      setTimeout(() => {
        $("#table-main").removeClass("d-none");
      }, 4000); // 5000 milliseconds = 5 seconds

      const loading = document.getElementById("toast-loading");
      function showloading() {
        loading.style.display = "flex";
      }

      function hideloading() {
        loading.style.display = "none";
      }
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
    <script src="//cdn.datatables.net/2.1.5/js/dataTables.min.js"></script>
    <script src="src/show_pbp.js"></script>
    <script src="src/zoom_image.js"></script>
    <script>
      $.ajax({
        type: "GET",
        url: "https://agungfirdevgithubio-default-rtdb.asia-southeast1.firebasedatabase.app/count.json",
        dataType: "json",
        success: function (count) {
          $.ajax({
            type: "PUT",
            url: "https://agungfirdevgithubio-default-rtdb.asia-southeast1.firebasedatabase.app/count.json",
            data: JSON.stringify(count + 1),
            success: function (data) {
              console.log("Data saved successfully!");
            },
            error: function (xhr, status, error) {
              console.log("Error saving data:", error);
            },
          });
        },
        error: function (xhr, status, error) {
          console.log("Error retrieving data:", error);
        },
      });
    </script>
    <script>
      let DESA = [];
      let PBP = [];
      let kecamatanSelected = null;
      let desaSelected = null;
      let statusSelected = 1;
      let filterPbp = [];
      let alokasi = null;
      let alokasiSelected = null;
      $.getJSON("data/DESA.json", function (data) {
        showloading();
        DESA = [...data];
        hideloading();
      });

      $("#select-alokasi").on("change", function () {
        showPbp([]);
        $("#select-kecamatan").prop("disabled", true);
        $("#select-desa").prop("disabled", true);
        alokasi = this.value;
        if (alokasi === null) {
          $("#select-alokasi").prop("disable", true);
          alokasiSelected = null;
          $("#select-kecamatan").prop("disabled", true);
        } else if (alokasi === "AGUSTUS") {
          alokasiSelected = "AGU";
          $("#select-desa").prop("disabled", false);
          $("#select-kecamatan").prop("disabled", false);
        } else if (alokasi === "OKTOBER") {
          alokasiSelected = "OKT";
          $("#select-desa").prop("disabled", false);
          $("#select-kecamatan").prop("disabled", false);
        }
      });

      $("#select-kecamatan").on("change", function () {
        showPbp([]);
        if (this.value !== "Pilih Kecamatan") {
          kecamatanSelected = this.value;
          $("#select-desa").prop("disabled", false);
          $("#select-desa")
            .find("option")
            .remove()
            .end()
            .append('<option value="whatever">Pilih desa..</option>');
          showSelectVillage(this.value);
        } else {
          $("#select-desa").prop("disabled", true);
          $("#select-desa")
            .find("option")
            .remove()
            .end()
            .append('<option value="whatever">Pilih dulu kecamatan..</option>')
            .val("Pilih dulu kecamatan");
          showSelectVillage("TIDAK ADA");
          showPbp([]);
        }
      });

      function showSelectVillage(kecamatan) {
        const filter = DESA.filter((desa) => desa.KECAMATAN === kecamatan);
        filter.forEach((desa) => {
          $("#select-desa").append(
            `<option value="${desa.DESA}">${desa.DESA}</option>`
          );
        });
      }

      $("#select-desa").on("change", function () {
        showPbp([]);
        desaSelected = this.value;

        if (desaSelected !== "Pilih desa..") {
          showloading();
          $.getJSON(
            `data/DATA_PENERIMA/KAB. PEMALANG_${kecamatanSelected}_${desaSelected}_${alokasiSelected}.json`,
            function (data) {
              PBP = [...data];

              filterPbp = PBP.filter(
                (pbp) =>
                  pbp.KECAMATAN === kecamatanSelected &&
                  pbp.DESA === desaSelected
              );
              $("#select-filter-status").attr("disabled", false);
              showPbp([]);
              showPbp(filterPbp);
              hideloading();
            }
          );
        } else {
          showSelectVillage("TIDAK ADA");
          showPbp([]);
        }
      });

      $("#header-status").on("click", function () {
        const show = $("#check-open-foto-all").is(":checked");
        if (statusSelected >= 5) {
          statusSelected = 1;
        } else {
          statusSelected++;
        }
        if (statusSelected === 1) {
          showPbp([]);
          showPbp(filterPbp, null, show);
        }
        if (statusSelected === 2) {
          showPbp([]);
          showPbp(filterPbp, "AWAL", show);
        }

        if (statusSelected === 3) {
          showPbp([]);
          showPbp(filterPbp, "PENGGANTI", show);
        }

        if (statusSelected === 4) {
          showPbp([]);
          showPbp(filterPbp, "PERWAKILAN", show);
        }

        if (statusSelected === 5) {
          showPbp([]);
          showPbp(filterPbp, "", show);
        }
      });

      $("#check-open-foto-all").change(function () {
        showPbp([]);
        showPbp(filterPbp, null, this.checked);
      });

      // $.ajax({
      //   type: "POST",
      //   url: "http://astridjplb.id/w/10/report/lap_pbp_tampil.php",
      //   data: {
      //     userid: "A110010001",
      //     kdkantor: "11001",
      //     namakantor: "JPLB-CABANG JATENG",
      //     level: "10",
      //     tahap: "47 | AGUSTUS",
      //     propinsi: "JAWA TENGAH",
      //     kota: "KAB. PEMALANG",
      //     kecamatan: kecamatanSelected,
      //     kelurahan: desaSelected,
      //   },
      //   crossDomain: true,
      //   headers: {
      //     "Access-Control-Allow-Origin": "https://astridjplb.id",
      //     "Access-Control-Allow-Methods": "GET, POST, PUT, DELETE, OPTIONS",
      //     "Access-Control-Allow-Headers":
      //       "Content-Type, Accept, Origin, X-Requested-With, Access-Control-Allow-Methods",
      //   },
      //   success: function (data) {
      //     console.log("Data sent successfully:", data);
      //   },
      //   error: function (xhr, status, error) {
      //     console.log("Error:", error);
      //   },
      // });
    </script>
  </body>
</html>
