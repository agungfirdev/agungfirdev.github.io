<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Banpang - 2024</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .hidden-row {
        padding: 0 !important;
      }
    </style>
  </head>
  <body>
    <div class="p-4">
      <h1 id="title">Data Penerima Bantuan Pangan</h1>
      <div class="d-flex gap-2">
        <div class="form-group w-100">
          <label for="select-kecamatan">Kecamatan</label>
          <select class="form-control" id="select-kecamatan">
            <option>Pilih Kecamatan</option>
            <option value="AMPELGADING">AMPELGADING</option>
            <option value="BANTARBOLANG">BANTARBOLANG</option>
            <option value="BELIK">BELIK</option>
            <option value="BODEH">BODEH</option>
            <option value="COMAL">COMAL</option>
            <option value="MOGA">MOGA</option>
            <option value="PEMALANG">PEMALANG</option>
            <option value="PETARUKAN">PETARUKAN</option>
            <option value="PULOSARI">PULOSARI</option>
            <option value="RANDUDONGKAL">RANDUDONGKAL</option>
            <option value="TAMAN">TAMAN</option>
            <option value="ULUJAMI">ULUJAMI</option>
            <option value="WARUNGPRING">WARUNGPRING</option>
            <option value="WATUKUMPUL">WATUKUMPUL</option>
          </select>
        </div>
        <div class="form-group w-100">
          <label for="select-desa">Desa</label>
          <select class="form-control" id="select-desa" disabled></select>
        </div>
      </div>
      <div class="mt-2">
        <span class="badge rounded-pill bg-light text-dark" id="jumlah-pbp"
          >JUMLAH</span
        >
        <span class="badge rounded-pill bg-dark" id="jumlah-awal">AWAL</span>
        <span class="badge rounded-pill bg-success" id="jumlah-pengganti"
          >PENGGANTI</span
        >
        <span class="badge rounded-pill bg-primary" id="jumlah-perwakilan"
          >PERWAKILAN</span
        >
      </div>
      <table class="table mt-4" id="table-main">
        <thead>
          <tr>
            <th scope="col" style="width: 3%">#</th>
            <th scope="col" style="width: 10%">NO PBP</th>
            <th scope="col" style="width: 12%">NIK</th>
            <th scope="col" style="width: 12%">NIK Penerima</th>
            <th scope="col">Nama</th>
            <th scope="col">Nama Penerima</th>
            <th scope="col">Status</th>
          </tr>
        </thead>
        <tbody id="table-body"></tbody>
      </table>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"></script>
    <script src="src/show_pbp.js"></script>

    <script>
      let DESA = [];
      let PBP = [];
      let kecamatanSelected = null;
      $.getJSON("data/DESA.json", function (data) {
        DESA = [...data];
      });

      $.getJSON("data/KAB. PEMALANG_AGU.json", function (data) {
        PBP = [...data];
      });

      $("#select-kecamatan").on("change", function () {
        if (this.value !== "Pilih Kecamatan") {
          kecamatanSelected = this.value;
          $("#select-desa").prop("disabled", false);
          $("#select-desa")
            .find("option")
            .remove()
            .end()
            .append('<option value="whatever">Pilih desa..</option>');
          showSelectVillage("TIDAK ADA");
          showSelectVillage(this.value);
        } else {
          $("#select-desa").prop("disabled", true);
          $("#select-desa")
            .find("option")
            .remove()
            .end()
            .append('<option value="whatever">Pilih dulu kecamatan..</option>')
            .val("Pilih dulu kecamatan");
          showSelectVillage("TIDAK ADA");
        }
      });

      function showSelectVillage(kecamatan) {
        const filter = DESA.filter((desa) => desa.KECAMATAN === kecamatan);
        filter.forEach((desa) => {
          $("#select-desa").append(
            `<option value="${desa.DESA}">${desa.DESA}</option>`
          );
        });
      }

      $("#select-desa").on("change", function () {
        if (this.value !== "Pilih desa..") {
          const filterPbp = PBP.filter(
            (pbp) =>
              pbp.KECAMATAN === kecamatanSelected && pbp.DESA === this.value
          );
          showPbp(filterPbp);
        } else {
          showSelectVillage("TIDAK ADA");
          showPbp([]);
        }
      });
    </script>
  </body>
</html>
